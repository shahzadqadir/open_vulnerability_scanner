import requests
import json


def authenticate(client_key, client_secret) -> str:
    base_url = "https://id.cisco.com/oauth2/default/v1/token"
    headers = {
        "Content-Type": "application/x-www-form-urlencoded"
    }
    payload = {
        "client_id": client_key,
        "client_secret": client_secret,
        "grant_type": "client_credentials"
    }
    response = requests.post(base_url, headers=headers, data=payload)
    if response.status_code == 200:
        return response.json()["access_token"]
    else:
        raise Exception("Invalid credentials.")
    
def get_bug_details(token:str) -> None:
    base_url = "https://apix.cisco.com/security/advisories/v2/cve/CVE-2018-0124"
    headers = {
        "Authorization": "Bearer " + token,
        "Accept": "application/json"
    }
    response = requests.get(base_url, headers=headers)
    print(response)


def get_advisory_by_software_version(token:str) -> None:
    base_url = "https://apix.cisco.com/security/advisories/v2/OSType/iosxe?version=17.2.1"
    headers = {
        "Authorization": "Bearer " + token,
        "Accept": "application/json"
    }
    response = requests.get(base_url, headers=headers)
    print(response.json())

if __name__ == "__main__":
    auth_key = authenticate("p69nvauhcrv6mgtstyegqspv", "3YBveQJAjz8kgQ32UXJgnRnv")
    # get_bug_details(auth_key)
    get_advisory_by_software_version(auth_key)

