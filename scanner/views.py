from django.shortcuts import render
from django.contrib.auth.decorators import login_required
from django.urls import reverse

from . import forms
from .helper_classes.vscanner import VulnerabilityScan


@login_required
def homepage(request):
    """Serves homepage with search forms.

    Args:
        request: HTTP Request object
    """
    form = forms.IOSVulnSearchForm()
    if request.method == "POST":
        ios_version = request.POST.get("ios")
        api_key = request.POST.get("api_key")
        customer_secret = request.POST.get("customer_secret")
        vs = VulnerabilityScan(api_key, customer_secret)
        advisories = vs.get_advisory_by_software_version(ios_version)
        return render(request, "list_advisories.html", {"advisories": advisories})

    return render(request, "homepage.html", {'form': form})